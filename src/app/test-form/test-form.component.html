<form [formGroup]="gradeHistoryForm" (ngSubmit)="onSubmit()">
  
  <mat-form-field appearance="fill">
    <mat-label>Class ID</mat-label>
    <input matInput id="class_id" type="text" formControlName="class_id">
    <mat-error *ngIf="class_id?.invalid && class_id?.touched">
      Class ID is required and must be at least 3 letters.
    </mat-error>
  </mat-form-field>

  
  <mat-form-field appearance="fill">
    <mat-label>Student ID</mat-label>
    <input matInput id="student_id" type="text" formControlName="student_id">
    <mat-error *ngIf="student_id?.invalid && student_id?.touched">
      Student ID is required.
    </mat-error>
  </mat-form-field>

 
  <button mat-raised-button color="primary" type="button" (click)="addGrade()">Add Grade</button>

  
  <div formArrayName="grades">
    <div *ngFor="let grade of grades.controls; let i = index; trackBy: trackById" [formGroupName]="i">
    
      <mat-form-field appearance="fill">
        <mat-label>Score</mat-label>
        <input matInput [id]="'score-' + grade.value.id" type="text" formControlName="score">
        <mat-error *ngIf="grade.get('score')?.invalid && grade.get('score')?.touched">
          Score is required and must be between 0 and 100.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Type</mat-label>
        <input matInput [id]="'type-' + grade.value.id" type="text" formControlName="type">
        <mat-error *ngIf="grade.get('type')?.invalid && grade.get('type')?.touched">
          Type is required.
        </mat-error>
      </mat-form-field>

     
      <button mat-raised-button color="warn" type="button" (click)="removeGrade(i)">Remove Grade</button>
    </div>
  </div>

 
  <button mat-raised-button color="primary" type="submit" [disabled]="gradeHistoryForm.invalid">Submit</button>

 
  <div *ngIf="formSubmitted && gradeHistoryForm.invalid">
    <p style="color: red;">Please fix the errors above before submitting the form.</p>
  </div>
</form>